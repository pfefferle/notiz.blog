---
ID: 546
post_title: X2V with PHP 5
author: Matthias Pfefferle
post_date: 2007-08-12 20:44:31
post_excerpt: ""
layout: post
permalink: >
  https://notiz.blog/2007/08/12/x2v-with-php-5/
published: true
---
Here are some code snippets to use the gorgeous <a href="http://suda.co.uk/projects/X2V/">X2V</a> microformats <abbr title="Extensible Stylesheet Language Transformation">XSLT</abbr> files from <a href="http://suda.co.uk/">Brian Suda</a> with PHP 5 and <a href="http://www.php.net/manual/de/ref.xsl.php">libxslt</a> (PHP 5 includes the XSL extension by default).

<strong>hCard to vCard</strong>:

To parse a XML or XHTML document, it has to be valid. To tidy the XML file, you can use a service from the <a href="http://cgi.w3.org/cgi-bin/tidy">W3C</a>:
<pre><code>$xml_string_tidy = file_get_contents("http://cgi.w3.org/cgi-bin/tidy?docAddr=".urlencode($uri));</code></pre>

Then you have to create the HTML DOM...
<pre><code>@$document = new DOMDocument();
@$document->loadHTML($xml_string_tidy);</code></pre>

and the XSLT DOM...
<pre><code>$stylesheet = new DOMDocument();
$stylesheet->load('hcard2vcard.xsl');</code></pre>

Create a new XSLT Processor, load the Stylesheet...
<pre><code>$processor = new XsltProcessor();
$processor->importStylesheet($stylesheet);</code></pre>

and run the transformation.
<pre><code>$result = $processor->transformToDoc($document);
$str = $result->saveXML();</code></pre>

Now <code>$str</code> contains the transformed code. 
To send the vCard header with PHP, try

<pre><code>header("Content-Disposition: attachment; filename=contact.vcf");
header("Content-Type: text/x-vcard; charset=UTF-8 name=contact.vcf");
echo $str;</code></pre>

If you want to use the vCard extension .vcf instead of .php you have to add something like that to your <code>.htaccess</code> file

<pre><code>RewriteEngine On
RewriteBase /
RewriteRule ^contact.vcf /hcard2vcard.php [L,QSA]</code></pre>

I hope it works :)